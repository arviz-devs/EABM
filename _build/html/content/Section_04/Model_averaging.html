

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Model Averaging &#8212; Exploratory analysis of Bayesian models</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/mystnb.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  
  <h1 class="site-logo" id="site-title">Exploratory analysis of Bayesian models</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/content/Section_04/Model_averaging.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#pseudo-bayesian-model-averaging" class="nav-link">Pseudo Bayesian model averaging</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#pseudo-bayesian-model-averaging-with-bayesian-bootstrapping" class="nav-link">Pseudo Bayesian model averaging with Bayesian Bootstrapping</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#stacking" class="nav-link">Stacking</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#weighted-posterior-predictive-samples" class="nav-link">Weighted posterior predictive samples</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#other-options" class="nav-link">Other options</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="model-averaging">
<h1>Model Averaging<a class="headerlink" href="#model-averaging" title="Permalink to this headline">¶</a></h1>
<p>Model averaging can be justified as being Bayesians about model uncertainty as we were Bayesians about parameter uncertainty. If we can not absolutely be sure that <strong>a</strong> model is <strong>the</strong> model (and generally we can not), then we should somehow take that uncertainty into account in our inferences. One way of doing this is by performing a weighted average of <strong>all the considered models</strong>, giving more weight to the models that seems to explain/predict the data better. To do this we can use both Information Criteria (IC) as well as the marginal likelihood.</p>
<div class="section" id="pseudo-bayesian-model-averaging">
<h2>Pseudo Bayesian model averaging<a class="headerlink" href="#pseudo-bayesian-model-averaging" title="Permalink to this headline">¶</a></h2>
<p>Bayesian models can be weighted by their marginal likelihood, this is known as Bayesian Model Averaging. While this is theoretically appealing, it is problematic in practice. As we already discussed in the Bayes Factor section, the computation of the maginal likelihood can easily become a minefield. An alternative route is to use the values of WAIC or LOO to estimate weights for each model. We can do this by using the following formula:</p>
<div class="math notranslate nohighlight">
\[w_i = \frac {e^{ - \frac{1}{2} dIC_i }} {\sum_j^M e^{ - \frac{1}{2} dIC_j }}\]</div>
<p>Where <span class="math notranslate nohighlight">\(dIC_i\)</span> is the difference between the i-esim information criterion value and the lowest one. We are assuming that we are using the deviance scale.</p>
<p>This approach is called pseudo Bayesian model averaging, or Akaike-like weighting and is an euristic way to compute the relative probability of each model (given a fixed set of models) from the information criteria values. See how the denominator is just a normalization term to ensure that the weights sum up to one.</p>
</div>
<div class="section" id="pseudo-bayesian-model-averaging-with-bayesian-bootstrapping">
<h2>Pseudo Bayesian model averaging with Bayesian Bootstrapping<a class="headerlink" href="#pseudo-bayesian-model-averaging-with-bayesian-bootstrapping" title="Permalink to this headline">¶</a></h2>
<p>The above formula for computing weights is a very nice and simple approach, but with one major caveat it does not take into account the uncertainty in the computation of the IC. We could compute the standard error of the IC (assuming a Gaussian approximation) and modify the above formula accordingly. Or we can do something more robust, like using a <a class="reference external" href="http://www.sumsar.net/blog/2015/04/the-non-parametric-bootstrap-as-a-bayesian-model/">Bayesian Bootstrapping</a> to estimate, and incorporate this uncertainty. This is the default approach used by ArviZ’s <code class="docutils literal notranslate"><span class="pre">compare(.)</span></code> function.</p>
</div>
<div class="section" id="stacking">
<h2>Stacking<a class="headerlink" href="#stacking" title="Permalink to this headline">¶</a></h2>
<p>Yet another option is known as <a class="reference external" href="https://arxiv.org/abs/1704.02030">stacking</a> of predictive distributions. We want to combine several models in a meta-model in order to minimize the divergence between the meta-model and the <em>true</em> generating model. When using a logarithmic scoring rule this is equivalently to compute:</p>
<div class="math notranslate nohighlight">
\[\max_{n} \frac{1}{n} \sum_{i=1}^{n}log\sum_{k=1}^{K} w_k p(y_i|y_{-i}, M_k)\]</div>
<p>Where <span class="math notranslate nohighlight">\(n\)</span> is the number of data points and <span class="math notranslate nohighlight">\(K\)</span> the number of models. To enforce a solution we constrain <span class="math notranslate nohighlight">\(w\)</span> to be <span class="math notranslate nohighlight">\(w_k \ge 0\)</span> and  <span class="math notranslate nohighlight">\(\sum_{k=1}^{K} w_k = 1\)</span>.</p>
<p>The quantity <span class="math notranslate nohighlight">\(p(y_i|y_{-i}, M_k)\)</span> is the leave-one-out predictive distribution for the <span class="math notranslate nohighlight">\(M_k\)</span> model. Computing it requires fitting each model <span class="math notranslate nohighlight">\(n\)</span> times, each time leaving out one data point. Fortunately we can approximate the exact leave-one-out predictive distribution using LOO (or even WAIC), and that is what ArviZ does in practice when we call <code class="docutils literal notranslate"><span class="pre">compare(method=&quot;stacking&quot;)</span></code>.</p>
</div>
<div class="section" id="weighted-posterior-predictive-samples">
<h2>Weighted posterior predictive samples<a class="headerlink" href="#weighted-posterior-predictive-samples" title="Permalink to this headline">¶</a></h2>
<p>Once we have computed the weights, using any of the above 3 methods (or in fact any other method we could think of), we can compute <em>weighted</em> posterior predictive samples. This is not something ArviZ computes but libraries like PyMC3 can do it for us:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pp_weighted_samples = pm.sample_posterior_predictive_w(traces, weights=cmp.weight)</span>
<span class="c1"># add example here</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="other-options">
<h2>Other options<a class="headerlink" href="#other-options" title="Permalink to this headline">¶</a></h2>
<p>There are other ways to average models such as, for example, explicitly building a meta-model including all the models we have. We then perform parameter inference while <em>jumping</em> between the models. One problem with this approach is that <em>jumping</em> between models is difficult for most samplers. Besides averaging discrete models we can sometimes think of continuous versions of them. A toy example is to imagine that we have a coin and we want to estimate its degree of bias, which is a number between 0 and 1 – being 0.5 equal chance of getting heads or tails. We could think of two separated models: one with a prior biased towards heads and one towards tails. We could fit both separate models and then average them using, for example, IC-derived weights. But we can also build a hierarchical model to estimate the prior from the data, and instead of contemplating two discrete models we will be computing a continuous model that includes these two discrete ones as particular cases.
This begs the question: which approach is better? And as is generally the case in statistics the correct answer depends on our concrete problem. Do we have background information supporting two discrete models, or is our problem better represented with a continuous bigger model?</p>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By ArviZ-devs<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>